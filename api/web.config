<configuration>
  <system.webServer>

	<!-- Tells iisnode that server.js is a node application -->
    <handlers>
      <add name="iisnode" path="longest_prefix.js" verb="*" modules="iisnode" />
    </handlers>

	<!-- tells iisnode to run server.js whenever the /node/server/service domain or its children are accessed -->
    <rewrite>
       <rules>
         <rule name="api">
           <match url="api/*" />
           <action type="Rewrite" url="longest_prefix.js" />
         </rule>
       </rules>
     </rewrite>

     <!-- exclude node_modules directory and subdirectories from serving
     by IIS since these are implementation details of node.js applications -->
     <security>
       <requestFiltering>
         <hiddenSegments>
           <add segment="node_modules" />
         </hiddenSegments>
       </requestFiltering>
     </security>

  </system.webServer>
</configuration>
